import React from 'react'
import { useForm } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'
import * as z from 'zod'

// shadcn/ui
import {
  Form,
  FormField,
  FormItem,
  FormLabel,
  FormControl,
  FormDescription,
  FormMessage,
} from '@/components/ui/form'
import { Input } from '@/components/ui/input'
import { Button } from '@/components/ui/button'
import { Switch } from '@/components/ui/switch'
import { Select, SelectTrigger, SelectValue, SelectContent, SelectItem } from '@/components/ui/select'
import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card'

// ---------------- ZOD SCHEMA ----------------
const slotConfigSchema = z.object({
  category: z.enum(['consultation', 'nursing', 'equipment']),

  consultationSlots: z.object({
    enabled: z.boolean(),
    startTime: z.string(),
    endTime: z.string(),
    slotDuration: z.number().int().min(1),
  }),

  nursingSlots: z.object({
    enabled: z.boolean(),
    shiftTypes: z.array(z.string()),
    minDuration: z.number().int().min(1),
    maxDuration: z.number().int().min(1),
    available24x7: z.boolean(),
    allowCustomDuration: z.boolean(),
  }),

  equipmentBooking: z.object({
    enabled: z.boolean(),
    minDuration: z.number().int().min(1),
    maxDuration: z.number().int().min(1),
    available24x7: z.boolean(),
  }),
})

export type SlotConfigFormValues = z.infer<typeof slotConfigSchema>

// ---------------- DEFAULT VALUES ----------------
const defaultValues: SlotConfigFormValues = {
  category: 'nursing',
  consultationSlots: {
    enabled: false,
    startTime: '09:00',
    endTime: '19:00',
    slotDuration: 30,
  },
  nursingSlots: {
    enabled: true,
    shiftTypes: ['24-hour'],
    minDuration: 1440,
    maxDuration: 1440,
    available24x7: true,
    allowCustomDuration: false,
  },
  equipmentBooking: {
    enabled: false,
    minDuration: 60,
    maxDuration: 720,
    available24x7: true,
  },
}

export default function SlotConfigForm() {
  const form = useForm<SlotConfigFormValues>({
    resolver: zodResolver(slotConfigSchema),
    defaultValues,
  })

  const category = form.watch('category')

  const onSubmit = (values: SlotConfigFormValues) => {
    console.log(values)
  }

  return (
    <Form {...form}>
      <form onSubmit={form.handleSubmit(onSubmit)} className="max-w-3xl mx-auto space-y-8">
        <Card>
          <CardHeader>
            <CardTitle>Slot Configuration</CardTitle>
          </CardHeader>
          <CardContent className="space-y-6">
            {/* Category */}
            <FormField
              control={form.control}
              name="category"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Category</FormLabel>
                  <FormControl>
                    <Select onValueChange={field.onChange} value={field.value}>
                      <SelectTrigger>
                        <SelectValue placeholder="Select category" />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="consultation">Consultation</SelectItem>
                        <SelectItem value="nursing">Nursing</SelectItem>
                        <SelectItem value="equipment">Equipment</SelectItem>
                      </SelectContent>
                    </Select>
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />

            {/* ---------------- CONSULTATION ---------------- */}
            {category === 'consultation' && (
              <div className="border p-4 rounded space-y-4">
                <FormField
                  control={form.control}
                  name="consultationSlots.enabled"
                  render={({ field }) => (
                    <FormItem className="flex items-center justify-between">
                      <FormLabel>Consultation Enabled</FormLabel>
                      <FormControl>
                        <Switch checked={field.value} onCheckedChange={field.onChange} />
                      </FormControl>
                      <FormMessage />
                    </FormItem>
                  )}
                />

                <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">
                  <FormField
                    control={form.control}
                    name="consultationSlots.startTime"
                    render={({ field }) => (
                      <FormItem>
                        <FormLabel>Start Time</FormLabel>
                        <FormControl>
                          <Input {...field} />
                        </FormControl>
                        <FormMessage />
                      </FormItem>
                    )}
                  />

                  <FormField
                    control={form.control}
                    name="consultationSlots.endTime"
                    render={({ field }) => (
                      <FormItem>
                        <FormLabel>End Time</FormLabel>
                        <FormControl>
                          <Input {...field} />
                        </FormControl>
                        <FormMessage />
                      </FormItem>
                    )}
                  />

                  <FormField
                    control={form.control}
                    name="consultationSlots.slotDuration"
                    render={({ field }) => (
                      <FormItem>
                        <FormLabel>Slot Duration (minutes)</FormLabel>
                        <FormControl>
                          <Input type="number" {...field} onChange={(e) => field.onChange(Number(e.target.value))} />
                        </FormControl>
                        <FormMessage />
                      </FormItem>
                    )}
                  />
                </div>
              </div>
            )}

            {/* ---------------- NURSING ---------------- */}
            {category === 'nursing' && (
              <div className="border p-4 rounded space-y-4">
                <FormField
                  control={form.control}
                  name="nursingSlots.enabled"
                  render={({ field }) => (
                    <FormItem className="flex items-center justify-between">
                      <FormLabel>Nursing Enabled</FormLabel>
                      <FormControl>
                        <Switch checked={field.value} onCheckedChange={field.onChange} />
                      </FormControl>
                      <FormMessage />
                    </FormItem>
                  )}
                />

                {/* Shift Types */}
                <FormItem>
                  <FormLabel>Shift Types</FormLabel>
                  <div className="flex flex-wrap gap-3 pt-2">
                    {['hourly', '12-hour', '24-hour', 'full-day', 'full-night'].map((t) => {
                      const selected = form.watch('nursingSlots.shiftTypes') || []
                      const isChecked = selected.includes(t)
                      return (
                        <label key={t} className="flex items-center gap-2 text-sm">
                          <input
                            type="checkbox"
                            checked={isChecked}
                            onChange={(e) => {
                              const arr = form.watch('nursingSlots.shiftTypes') || []
                              if (e.target.checked) {
                                form.setValue('nursingSlots.shiftTypes', [...arr, t])
                              } else {
                                form.setValue('nursingSlots.shiftTypes', arr.filter((x) => x !== t))
                              }
                            }}
                          />
                          <span className="capitalize">{t}</span>
                        </label>
                      )
                    })}
                  </div>
                </FormItem>

                <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">
                  <FormField
                    control={form.control}
                    name="nursingSlots.minDuration"
                    render={({ field }) => (
                      <FormItem>
                        <FormLabel>Min Duration</FormLabel>
                        <FormControl>
                          <Input type="number" {...field} onChange={(e) => field.onChange(Number(e.target.value))} />
                        </FormControl>
                        <FormMessage />
                      </FormItem>
                    )}
                  />

                  <FormField
                    control={form.control}
                    name="nursingSlots.maxDuration"
                    render={({ field }) => (
                      <FormItem>
                        <FormLabel>Max Duration</FormLabel>
                        <FormControl>
                          <Input type="number" {...field} onChange={(e) => field.onChange(Number(e.target.value))} />
                        </FormControl>
                        <FormMessage />
                      </FormItem>
                    )}
                  />

                  <FormField
                    control={form.control}
                    name="nursingSlots.available
